#!/bin/bash
#-----------------------------------------------------------------------------
#   arcasHLA: high resolution HLA typing from RNA seq
#-----------------------------------------------------------------------------
#
#   Authors:    Rose Orenbuch, Ioan Filip, Itsik Pe'er
#   Date:       November 2018
#   Version:    1.0
#   License:    GNU
#
#-----------------------------------------------------------------------------
#   
#   arcasHLA types high resolution HLA alleles from BAM.
#
#-----------------------------------------------------------------------------
#   Requirements
#-----------------------------------------------------------------------------

missing=$false
if [ ! -x "$(command -v kallisto pseudo)" ]; then
    echo "Missing dependency: Kallisto v0.44.0"
    missing=$true
fi

if [ ! -x "$(command -v samtools)" ]; then
    echo "Missing dependency: Samtools"
    missing=$true
fi

if [ ! -x "$(command -v bedtools)" ]; then
    echo "Missing dependency: bedtools"
    missing=$true
fi

if [ ! -x "$(command -v pigz)" ]; then
    echo "Missing dependency: pigz"
    missing=$true
fi

if [ ! -x "$(command -v python3 -c "import numpy")" ]; then
    echo "Missing dependency: python3 module NumPy"
    missing=$true
fi

if [ ! -x "$(command -v python3 -c "import pandas")" ]; then
    echo "Missing dependency: python3 module pandas"
    missing=$true
fi

if [ ! -x "$(command -v python3 -c "import Bio")" ]; then
    echo "Missing dependency: python3 module Biopython"
    missing=$true
fi

if [ $missing == $true ]; then
    exit 1
fi

#-----------------------------------------------------------------------------
#   Tools
#-----------------------------------------------------------------------------

if [ "$1" == "extract" ]; then

    python3 ./scripts/extract.py ${@:2}

elif [ "$1" == "genotype" ]; then

    python3 ./scripts/genotype.py ${@:2}

elif [ "$1" == "merge" ]; then

    python3 ./scripts/merge.py ${@:2}

elif [ "$1" == "reference" ]; then

    python3 ./scripts/reference.py ${@:2}

elif [ "$1" == "partial" ]; then

    python3 ./scripts/partial.py ${@:2}
    
#-----------------------------------------------------------------------------
#   Usage
#-----------------------------------------------------------------------------

else
    echo "Usage: arcasHLA <command> [options]"
    echo
    echo "    extract        extracts chromosome 6 reads from bam"
    echo "    genotype       types HLA genes from extracted reads"
    echo "    partial        types partial HLA genes from extracted reads"
    echo "    merge          processes results into a tab-separated table"
    echo "    reference      check or update HLA reference"
    echo 
    echo "Note: run any command with --help to view required fields, options"
    echo
fi

#-------------------------------------------------------------------------------
